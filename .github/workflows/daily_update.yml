name: Daily NBA Prediction & Grading

on:
  schedule:
    # 1. æˆ°ç¸¾æ›´æ–°æ™‚æ®µï¼šå°ç£ 10:00 - 15:59 (UTC 02:00 - 07:59)
    #    è¨­å®šç‚ºæ¯å°æ™‚çš„ 0 åˆ†èˆ‡ 30 åˆ†åŸ·è¡Œä¸€æ¬¡
    #    (2-7 è¡¨ç¤º UTC 2, 3, 4, 5, 6, 7 é»)
    - cron: '0,30 2-7 * * *'
    
    # 2. æ™šé–“é æ¸¬æ™‚æ®µï¼šå°ç£ 22:00 (UTC 14:00)
    #    å»ºè­°æ”¹ç‚º 14:05ï¼Œé¿é–‹å…¨çƒæ•´é»é«˜å³°ï¼Œæ›´å®¹æ˜“æº–æ™‚è§¸ç™¼
    - cron: '5 14 * * *'

  # æ‰‹å‹•è§¸ç™¼æŒ‰éˆ•
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.9'

    - name: Install dependencies
      # é€™è£¡æœƒè®€å–æˆ‘å€‘å‰›æ›´æ–°çš„ requirements.txt
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run NBA Logic
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
      run: |
        # 1. ç„¡è«–å¹¾é»ï¼Œç¸½æ˜¯å…ˆæŠ“è³½ç¨‹èˆ‡æ¯”åˆ† (æ›´æ–°å³æ™‚åˆ†æ•¸)
        echo "ğŸ€ Fetching Schedule & Scores..."
        python scrape_schedule.py
        
        # 2. ç„¡è«–å¹¾é»ï¼Œç¸½æ˜¯æŠ“æœ€æ–°è³ ç‡
        echo "ğŸ“Š Fetching Odds..."
        python scrape_odds.py
        
        # 3. [é—œéµåˆ¤æ–·] åªæœ‰åœ¨ã€Œæ™šä¸Š 10 é»ã€æˆ–ã€Œæ‰‹å‹•è§¸ç™¼ã€æ™‚ï¼Œæ‰åŸ·è¡Œé æ¸¬
        # UTC 14:00 = å°ç£ 22:00
        
        CURRENT_HOUR=$(date -u +%H)
        EVENT_NAME="${{ github.event_name }}"
        
        echo "Current UTC Hour: $CURRENT_HOUR"
        
        # æ³¨æ„ï¼šShell script çš„æ¯”å°æœ‰æ™‚å€™æœƒå› ç‚ºå‰å°é›¶å‡ºéŒ¯ï¼Œé€™è£¡ç”¨å­—ä¸²æ¯”å°è¼ƒå®‰å…¨
        if [ "$CURRENT_HOUR" == "14" ] || [ "$EVENT_NAME" == "workflow_dispatch" ]; then
          echo "ğŸš€ ç¾åœ¨æ˜¯æ™šä¸Š (æˆ–æ‰‹å‹•è§¸ç™¼)ï¼ŒåŸ·è¡Œ AI é æ¸¬æ¨¡å‹..."
          python aggregate_picks.py
        else
          echo "ğŸ›‘ ç¾åœ¨æ˜¯æ—¥é–“æ›´æ–°æ™‚æ®µ (åªæ›´æ–°æ¯”åˆ†)ï¼Œè·³éé æ¸¬æ­¥é©Ÿã€‚"
        fi
        
        # 4. ç„¡è«–å¹¾é»ï¼Œç¸½æ˜¯åŸ·è¡Œçµç®— (Grade Picks)
        # é€™æ¨£æ—©ä¸Š 10 é»ã€11 é»...åªè¦æ¯”è³½ä¸€æ‰“å®Œï¼Œå‹ç‡å°±æœƒæ›´æ–°
        echo "ğŸ“ Grading Picks..."
        python grade_picks.py